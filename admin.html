<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>æ¸²æŸ“æ–‡åŒ–ç®¡ç†åå°</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI','PingFang SC','Microsoft YaHei',sans-serif;background:#0a0a0a;color:#fff;line-height:1.6}
input,textarea,button{font-family:inherit}

/* ç™»å½• */
#loginPage{position:fixed;top:0;left:0;width:100%;height:100%;background:#0a0a0a;display:flex;align-items:center;justify-content:center;z-index:9999}
.login-box{width:90%;max-width:360px;padding:40px 30px;background:#111;border:1px solid #222;border-radius:8px;text-align:center}
.login-box h1{font-size:26px;margin-bottom:8px}
.login-box .gold{color:#d4a55c}
.login-box .subtitle{color:#666;margin-bottom:30px;font-size:14px}
.login-box input{width:100%;padding:12px 15px;background:#1a1a1a;border:1px solid #333;color:#fff;border-radius:4px;font-size:15px;margin-bottom:15px}
.login-box button{width:100%;padding:14px;background:#d4a55c;color:#000;border:none;border-radius:4px;font-size:16px;font-weight:600;cursor:pointer}
.login-box .error{color:#ff4444;margin-top:10px;font-size:14px;display:none}

/* ç®¡ç†é¢æ¿ */
#adminPage{display:none;padding:15px;max-width:800px;margin:0 auto}
.header{display:flex;justify-content:space-between;align-items:center;padding:15px 0;border-bottom:1px solid #222;margin-bottom:20px}
.header h2{font-size:18px}
.header .gold{color:#d4a55c}
.header button{padding:8px 16px;background:transparent;border:1px solid #444;color:#888;border-radius:4px;cursor:pointer;font-size:13px}

/* åŒºå— */
.section{background:#111;border:1px solid #222;border-radius:8px;padding:20px;margin-bottom:20px}
.section h3{color:#d4a55c;font-size:15px;margin-bottom:15px;padding-bottom:10px;border-bottom:1px solid #222}

/* è¡¨å• */
.form-group{margin-bottom:15px}
.form-group label{display:block;margin-bottom:5px;color:#888;font-size:13px}
.form-group input,.form-group textarea{width:100%;padding:10px 12px;background:#1a1a1a;border:1px solid #333;color:#fff;border-radius:4px;font-size:14px}
.form-group textarea{min-height:60px;resize:vertical}
.form-row{display:flex;gap:15px}
.form-row .form-group{flex:1}
@media(max-width:600px){.form-row{flex-direction:block}}

/* ä½œå“åˆ—è¡¨ */
.work-item{display:flex;gap:12px;padding:12px;background:#1a1a1a;border-radius:6px;margin-bottom:10px;align-items:center}
.work-thumb{width:80px;height:45px;background:#222;border-radius:4px;display:flex;align-items:center;justify-content:center;color:#555;font-size:11px;overflow:hidden;flex-shrink:0}
.work-thumb img{width:100%;height:100%;object-fit:cover}
.work-info{flex:1;min-width:0}
.work-info .title{font-size:14px;margin-bottom:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.work-info .desc{font-size:12px;color:#888;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.work-item button{padding:6px 12px;background:transparent;border:1px solid #ff4444;color:#ff4444;border-radius:4px;cursor:pointer;font-size:12px;flex-shrink:0}

.add-btn{width:100%;padding:12px;background:transparent;border:2px dashed #333;color:#888;border-radius:6px;cursor:pointer;margin-bottom:15px}
.add-btn:active{border-color:#d4a55c;color:#d4a55c}

/* å‘å¸ƒ */
.publish-section{background:#0d0d0d;border:1px solid #333;border-radius:8px;padding:20px;margin-top:20px}
.publish-section h4{color:#d4a55c;margin-bottom:8px}
.publish-section p{color:#666;font-size:12px;margin-bottom:15px}
.publish-section input{width:100%;padding:10px 12px;background:#1a1a1a;border:1px solid #333;color:#fff;border-radius:4px;margin-bottom:12px;font-size:14px}
.publish-section button{width:100%;padding:12px;background:#2ea043;color:#fff;border:none;border-radius:4px;font-size:15px;cursor:pointer}

/* å¼¹çª— */
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.9);z-index:10000;align-items:center;justify-content:center;padding:20px}
.modal.show{display:flex}
.modal-content{background:#111;border:1px solid #333;border-radius:8px;width:100%;max-width:450px;padding:25px;max-height:90vh;overflow-y:auto}
.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}
.modal-header h3{font-size:16px}
.modal-close{background:none;border:none;color:#888;font-size:24px;cursor:pointer}
.modal button{width:100%;padding:12px;background:#d4a55c;color:#000;border:none;border-radius:4px;font-size:15px;cursor:pointer;margin-top:10px}

/* æç¤º */
.toast{position:fixed;top:20px;left:50%;transform:translateX(-50%) translateY(-100px);background:#d4a55c;color:#000;padding:12px 25px;border-radius:4px;font-weight:500;transition:transform 0.3s;z-index:10001}
.toast.show{transform:translateX(-50%) translateY(0)}
</style>
</head>
<body>

<!-- ç™»å½•é¡µ -->
<div id="loginPage">
  <div class="login-box">
    <h1>æ¸²æŸ“<span class="gold">æ–‡åŒ–</span></h1>
    <p class="subtitle">ç½‘ç«™ç®¡ç†åå°</p>
    <input type="password" id="pwd" placeholder="è¯·è¾“å…¥å¯†ç ">
    <button onclick="login()">ç™» å½•</button>
    <p class="error" id="err">å¯†ç é”™è¯¯</p>
  </div>
</div>

<!-- ç®¡ç†é¡µ -->
<div id="adminPage">
  <div class="header">
    <h2>æ¸²æŸ“<span class="gold">æ–‡åŒ–</span> - ç®¡ç†åå°</h2>
    <button onclick="logout()">é€€å‡º</button>
  </div>

  <!-- ä½œå“ç®¡ç† -->
  <div class="section">
    <h3>ä½œå“ç®¡ç†</h3>
    <button class="add-btn" onclick="openModal()">+ æ·»åŠ æ–°ä½œå“</button>
    <div id="worksList"></div>
  </div>

  <!-- å…¬å¸ä¿¡æ¯ -->
  <div class="section">
    <h3>å…¬å¸ä¿¡æ¯</h3>
    <div class="form-row">
      <div class="form-group">
        <label>å…¬å¸åç§°</label>
        <input type="text" id="cName" value="æˆéƒ½æ¸²æŸ“æ–‡åŒ–ä¼ åª’æœ‰é™å…¬å¸">
      </div>
      <div class="form-group">
        <label>å“ç‰Œå£å·</label>
        <input type="text" id="cTagline" value="ç”¨ç”µå½±è¯­è¨€è®²è¿°å“ç‰Œæ•…äº‹">
      </div>
    </div>
    <div class="form-group">
      <label>å…¬å¸ç®€ä»‹</label>
      <textarea id="cDesc">æˆéƒ½æ¸²æŸ“æ–‡åŒ–ä¼ åª’æœ‰é™å…¬å¸ï¼Œæˆç«‹äº2019å¹´ï¼Œæ˜¯ä¸€å®¶ä¸“æ³¨äºå½±åƒåˆ›ä½œçš„ä¸“ä¸šå›¢é˜Ÿã€‚</textarea>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label>å¹´æ•°</label>
        <input type="text" id="sYears" value="5+">
      </div>
      <div class="form-group">
        <label>é¡¹ç›®æ•°</label>
        <input type="text" id="sProjects" value="200+">
      </div>
    </div>
    <div class="form-group">
      <label>è·èµæ”¶è—</label>
      <input type="text" id="sLikes" value="2.5ä¸‡+">
    </div>
  </div>

  <!-- è”ç³»æ–¹å¼ -->
  <div class="section">
    <h3>è”ç³»æ–¹å¼</h3>
    <div class="form-row">
      <div class="form-group">
        <label>ç”µè¯</label>
        <input type="text" id="cPhone" value="185 8249 3173">
      </div>
      <div class="form-group">
        <label>å¾®ä¿¡</label>
        <input type="text" id="cWechat" placeholder="é€‰å¡«">
      </div>
    </div>
    <div class="form-group">
      <label>é‚®ç®±</label>
      <input type="text" id="cEmail" placeholder="é€‰å¡«">
    </div>
  </div>

  <!-- å‘å¸ƒ -->
  <div class="publish-section">
    <h4>å‘å¸ƒç½‘ç«™</h4>
    <p>è¾“å…¥ GitHub Token åç‚¹å‡»å‘å¸ƒ</p>
    <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxx">
    <button onclick="publish()">ğŸš€ å‘å¸ƒç½‘ç«™</button>
  </div>
</div>

<!-- æ·»åŠ ä½œå“å¼¹çª— -->
<div class="modal" id="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>æ·»åŠ ä½œå“</h3>
      <button class="modal-close" onclick="closeModal()">Ã—</button>
    </div>
    <div class="form-group">
      <label>ä½œå“æ ‡é¢˜ *</label>
      <input type="text" id="mTitle" placeholder="ä¾‹å¦‚ï¼š361Â° å“ç‰Œ TVC">
    </div>
    <div class="form-group">
      <label>ä½œå“æè¿°</label>
      <input type="text" id="mDesc" placeholder="ç®€çŸ­æè¿°">
    </div>
    <div class="form-group">
      <label>Bç«™è§†é¢‘é“¾æ¥ *</label>
      <input type="text" id="mVideo" placeholder="https://b23.tv/xxxxx">
    </div>
    <div class="form-group">
      <label>å°é¢å›¾ç‰‡ URLï¼ˆé€‰å¡«ï¼‰</label>
      <input type="text" id="mImage" placeholder="https://...">
    </div>
    <button onclick="saveWork()">ä¿ å­˜</button>
  </div>
</div>

<!-- æç¤º -->
<div class="toast" id="toast"></div>

<script>
// æ•°æ®å­˜å‚¨
var works = [];

// é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
window.onload = function() {
  // ä»localStorageè¯»å–æ•°æ®
  var saved = localStorage.getItem('xr_works');
  if (saved) {
    works = JSON.parse(saved);
  } else {
    // é»˜è®¤æ•°æ®
    works = [{
      id: 1,
      title: 'ã€æˆ‘ç”¨GH6æ‹äº†ä¸€éƒ¨è’é‡å¤§é•–å®¢ã€‘',
      desc: '361Â° å“ç‰Œ TVC',
      video: 'https://b23.tv/xi4SUa1',
      bvid: 'BV1Zf421i7zq',
      image: 'images/work-361.jpg'
    }];
    saveData();
  }
  
  // ç»‘å®šå›è½¦ç™»å½•
  document.getElementById('pwd').onkeypress = function(e) {
    if (e.keyCode === 13) login();
  };
};

// ä¿å­˜åˆ°localStorage
function saveData() {
  localStorage.setItem('xr_works', JSON.stringify(works));
}

// ç™»å½•
function login() {
  var pwd = document.getElementById('pwd').value;
  if (pwd === 'xuanran2024') {
    document.getElementById('loginPage').style.display = 'none';
    document.getElementById('adminPage').style.display = 'block';
    renderWorks();
    showToast('ç™»å½•æˆåŠŸ');
  } else {
    document.getElementById('err').style.display = 'block';
  }
}

// é€€å‡º
function logout() {
  document.getElementById('loginPage').style.display = 'flex';
  document.getElementById('adminPage').style.display = 'none';
  document.getElementById('pwd').value = '';
  document.getElementById('err').style.display = 'none';
}

// æ¸²æŸ“ä½œå“åˆ—è¡¨
function renderWorks() {
  var html = '';
  for (var i = 0; i < works.length; i++) {
    var w = works[i];
    html += '<div class="work-item">';
    html += '<div class="work-thumb">';
    if (w.image) {
      html += '<img src="' + w.image + '" onerror="this.style.display=\'none\'" alt="">';
    }
    html += '</div>';
    html += '<div class="work-info">';
    html += '<div class="title">' + w.title + '</div>';
    html += '<div class="desc">' + w.desc + '</div>';
    html += '</div>';
    html += '<button onclick="delWork(' + w.id + ')">åˆ é™¤</button>';
    html += '</div>';
  }
  document.getElementById('worksList').innerHTML = html;
}

// æ‰“å¼€å¼¹çª—
function openModal() {
  document.getElementById('modal').classList.add('show');
}

// å…³é—­å¼¹çª—
function closeModal() {
  document.getElementById('modal').classList.remove('show');
  document.getElementById('mTitle').value = '';
  document.getElementById('mDesc').value = '';
  document.getElementById('mVideo').value = '';
  document.getElementById('mImage').value = '';
}

// ä¿å­˜ä½œå“
function saveWork() {
  var title = document.getElementById('mTitle').value.trim();
  var desc = document.getElementById('mDesc').value.trim();
  var video = document.getElementById('mVideo').value.trim();
  var image = document.getElementById('mImage').value.trim();
  
  if (!title || !video) {
    showToast('è¯·å¡«å†™æ ‡é¢˜å’Œè§†é¢‘é“¾æ¥');
    return;
  }
  
  // æå–BVå·
  var bvid = '';
  var match = video.match(/BV[a-zA-Z0-9]+/);
  if (match) {
    bvid = match[0];
  }
  
  works.push({
    id: Date.now(),
    title: title,
    desc: desc,
    video: video,
    bvid: bvid,
    image: image
  });
  
  saveData();
  renderWorks();
  closeModal();
  showToast('æ·»åŠ æˆåŠŸ');
}

// åˆ é™¤ä½œå“
function delWork(id) {
  if (confirm('ç¡®å®šåˆ é™¤æ­¤ä½œå“ï¼Ÿ')) {
    var newWorks = [];
    for (var i = 0; i < works.length; i++) {
      if (works[i].id !== id) {
        newWorks.push(works[i]);
      }
    }
    works = newWorks;
    saveData();
    renderWorks();
    showToast('å·²åˆ é™¤');
  }
}

// æ˜¾ç¤ºæç¤º
function showToast(msg) {
  var t = document.getElementById('toast');
  t.innerHTML = msg;
  t.classList.add('show');
  setTimeout(function() {
    t.classList.remove('show');
  }, 2500);
}

// ç”Ÿæˆç½‘ç«™HTML
function generateSite() {
  var data = {
    company: document.getElementById('cName').value,
    tagline: document.getElementById('cTagline').value,
    desc: document.getElementById('cDesc').value,
    years: document.getElementById('sYears').value,
    projects: document.getElementById('sProjects').value,
    likes: document.getElementById('sLikes').value,
    phone: document.getElementById('cPhone').value,
    wechat: document.getElementById('cWechat').value,
    email: document.getElementById('cEmail').value
  };
  
  // æ„å»ºä½œå“HTML
  var worksHtml = '';
  for (var i = 0; i < works.length; i++) {
    var w = works[i];
    var bg = w.image ? 'background-image:url(' + w.image + ')' : 'background:#222';
    worksHtml += '<div class="work-item" style="' + bg + ';background-size:cover;background-position:center" onclick="play(\'' + w.bvid + '\')">';
    worksHtml += '<div class="work-overlay"><h4>' + (w.desc || w.title) + '</h4><p>ç‚¹å‡»æ’­æ”¾ â†’</p></div>';
    worksHtml += '</div>';
  }
  
  // å®Œæ•´HTML
  var html = '<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>' + data.company + '</title>';
  html += '<style>*{margin:0;padding:0;box-sizing:border-box}:root{--bg:#0a0a0a;--card:#111;--text:#fff;--text2:#888;--accent:#d4a55c;--border:#222}body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","PingFang SC",sans-serif;background:var(--bg);color:var(--text)}';
  html += 'nav{position:fixed;top:0;width:100%;padding:1.2rem 5%;display:flex;justify-content:space-between;align-items:center;z-index:1000;background:linear-gradient(to bottom,rgba(10,10,10,0.95),transparent)}';
  html += '.logo{font-size:1.4rem;font-weight:700}.logo span{color:var(--accent)}.nav-links{display:flex;gap:2rem;list-style:none}.nav-links a{color:var(--text2);text-decoration:none;font-size:0.9rem}';
  html += '.hero{height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;background:radial-gradient(ellipse at 20% 80%,rgba(212,165,92,0.1) 0%,transparent 50%)}';
  html += '.hero h1{font-size:clamp(2.5rem,7vw,5rem);font-weight:700;letter-spacing:0.15em}';
  html += '.hero .subtitle{color:var(--accent);letter-spacing:0.5em;margin:1rem 0 2rem;font-size:1rem}';
  html += '.hero p{color:var(--text2);max-width:500px;margin:0 auto 2rem;padding:0 20px}';
  html += '.btn{display:inline-block;padding:0.8rem 2rem;border:1px solid var(--accent);color:var(--accent);text-decoration:none;font-size:0.9rem}';
  html += '.about,.services{padding:6rem 5%;background:var(--card)}.works{padding:6rem 5%}';
  html += '.container{max-width:1000px;margin:0 auto}.section-title{color:var(--accent);font-size:0.75rem;letter-spacing:0.3em;margin-bottom:0.5rem}';
  html += '.section-heading{font-size:clamp(1.5rem,4vw,2.5rem);margin-bottom:2rem}';
  html += '.about-content{display:grid;grid-template-columns:1fr 1fr;gap:3rem;align-items:center}';
  html += '.about-text p{color:var(--text2);line-height:1.8;margin-bottom:1rem}';
  html += '.stats{display:grid;grid-template-columns:repeat(3,1fr);gap:1.5rem;margin-top:2rem}';
  html += '.stat-item h3{font-size:2rem;color:var(--accent)}.stat-item p{font-size:0.8rem;color:var(--text2)}';
  html += '.works-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:1rem}';
  html += '.work-item{aspect-ratio:16/9;border:1px solid var(--border);position:relative;overflow:hidden;cursor:pointer}';
  html += '.work-overlay{position:absolute;bottom:0;left:0;right:0;padding:1rem;background:linear-gradient(to top,rgba(0,0,0,0.9),transparent);transform:translateY(100%);transition:0.3s}';
  html += '.work-item:hover .work-overlay{transform:translateY(0)}';
  html += '.services-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:1.5rem}';
  html += '.service-item{padding:1.5rem;background:var(--bg);border:1px solid var(--border)}';
  html += '.service-num{color:var(--accent);font-size:0.75rem;margin-bottom:0.5rem}';
  html += '.service-item h3{font-size:1rem;margin-bottom:0.5rem}.service-item p{font-size:0.85rem;color:var(--text2)}';
  html += '.contact{padding:6rem 5%;text-align:center}.contact-info{display:flex;justify-content:center;gap:3rem;margin-top:2rem}';
  html += '.contact-item h4{font-size:0.7rem;color:var(--text2);margin-bottom:0.3rem}.contact-item p{font-size:1rem}';
  html += 'footer{padding:2rem;background:var(--card);border-top:1px solid var(--border);text-align:center;color:var(--text2);font-size:0.8rem}';
  html += '@media(max-width:768px){.about-content,.services-grid{grid-template-columns:1fr}.works-grid{grid-template-columns:1fr}.contact-info{flex-direction:column;gap:1rem}.nav-links{display:none}}';
  html += '</style></head><body>';
  
  // å¯¼èˆª
  html += '<nav><div class="logo">æ¸²æŸ“<span>.</span></div><ul class="nav-links"><li><a href="#about">å…³äº</a></li><li><a href="#works">ä½œå“</a></li><li><a href="#services">æœåŠ¡</a></li><li><a href="#contact">è”ç³»</a></li></ul></nav>';
  
  // Hero
  html += '<section class="hero"><h1>' + data.company.replace('æœ‰é™å…¬å¸','') + '</h1>';
  html += '<div class="subtitle">XUANRAN CULTURE</div>';
  html += '<p>' + data.tagline + '<br>' + data.desc.substring(0,30) + '...</p>';
  html += '<a href="#works" class="btn">æŸ¥çœ‹ä½œå“</a></section>';
  
  // å…³äº
  html += '<section class="about" id="about"><div class="container">';
  html += '<div class="section-title">ABOUT US</div><h2 class="section-heading">å…³äºæˆ‘ä»¬</h2>';
  html += '<div class="about-content">';
  html += '<div class="about-text"><p>' + data.desc + '</p>';
  html += '<div class="stats">';
  html += '<div class="stat-item"><h3>' + data.years + '</h3><p>å¹´è¡Œä¸šç»éªŒ</p></div>';
  html += '<div class="stat-item"><h3>' + data.projects + '</h3><p>å®Œæˆé¡¹ç›®</p></div>';
  html += '<div class="stat-item"><h3>' + data.likes + '</h3><p>è·èµæ”¶è—</p></div>';
  html += '</div></div>';
  html += '<div style="background:var(--card);aspect-ratio:4/3;display:flex;align-items:center;justify-content:center;color:var(--text2)">[å›¢é˜Ÿç…§ç‰‡]</div>';
  html += '</div></div></section>';
  
  // ä½œå“
  html += '<section class="works" id="works"><div class="container">';
  html += '<div class="section-title">SELECTED WORKS</div><h2 class="section-heading">ç²¾é€‰ä½œå“</h2>';
  html += '<div class="works-grid">' + worksHtml + '</div>';
  html += '</div></section>';
  
  // æœåŠ¡
  html += '<section class="services" id="services"><div class="container">';
  html += '<div class="section-title">SERVICES</div><h2 class="section-heading">æœåŠ¡èŒƒå›´</h2>';
  html += '<div class="services-grid">';
  html += '<div class="service-item"><div class="service-num">01</div><h3>TVCå¹¿å‘Š</h3><p>å“ç‰Œç”µè§†å¹¿å‘Šæ‹æ‘„</p></div>';
  html += '<div class="service-item"><div class="service-num">02</div><h3>å®£ä¼ ç‰‡</h3><p>ä¼ä¸šå®£ä¼ ç‰‡åˆ¶ä½œ</p></div>';
  html += '<div class="service-item"><div class="service-num">03</div><h3>çŸ­è§†é¢‘</h3><p>ç¤¾äº¤åª’ä½“å†…å®¹</p></div>';
  html += '<div class="service-item"><div class="service-num">04</div><h3>å‰§æƒ…ç‰‡</h3><p>ç”µå½±æ„Ÿå™äº‹</p></div>';
  html += '</div></div></section>';
  
  // è”ç³»
  html += '<section class="contact" id="contact"><div class="container">';
  html += '<div class="section-title">CONTACT</div><h2 class="section-heading">è”ç³»æˆ‘ä»¬</h2>';
  html += '<p style="color:var(--text2)">å¦‚æœæ‚¨æœ‰é¡¹ç›®éœ€æ±‚æˆ–åˆä½œæ„å‘<br>æ¬¢è¿éšæ—¶ä¸æˆ‘ä»¬è”ç³»</p>';
  html += '<div class="contact-info">';
  html += '<div class="contact-item"><h4>ç”µè¯</h4><p>' + data.phone + '</p></div>';
  if (data.wechat) html += '<div class="contact-item"><h4>å¾®ä¿¡</h4><p>' + data.wechat + '</p></div>';
  if (data.email) html += '<div class="contact-item"><h4>é‚®ç®±</h4><p>' + data.email + '</p></div>';
  html += '</div></div></section>';
  
  // åº•éƒ¨
  html += '<footer><p>Â© 2024 ' + data.company + ' | XUANRAN CULTURE</p></footer>';
  
  // æ’­æ”¾è„šæœ¬
  html += '<script>function play(bvid){var d=document.createElement("div");d.style.cssText="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.95);z-index:9999;display:flex;justify-content:center;align-items:center";var c=document.createElement("button");c.innerHTML="âœ•";c.style.cssText="position:absolute;top:20px;right:20px;background:none;border:2px solid rgba(255,255,255,0.3);color:#fff;font-size:20px;width:40px;height:40px;border-radius:50%;cursor:pointer";c.onclick=function(){document.body.removeChild(d)};var b=document.createElement("div");b.style.cssText="width:90%;max-width:900px;aspect-ratio:16/9";var a=document.createElement("iframe");a.src="https://player.bilibili.com/player.html?bvid="+bvid+"\u0026page=1";a.style.cssText="width:100%;height:100%;border:none;border-radius:8px";a.allowFullscreen=true;b.appendChild(a);d.appendChild(c);d.appendChild(b);document.body.appendChild(d);d.onclick=function(e){if(e.target===d){document.body.removeChild(d)}}}</script>';
  
  html += '</body></html>';
  return html;
}

// å‘å¸ƒ
function publish() {
  var token = document.getElementById('token').value.trim();
  if (!token) {
    showToast('è¯·è¾“å…¥ GitHub Token');
    return;
  }
  
  showToast('æ­£åœ¨å‘å¸ƒ...');
  
  var html = generateSite();
  
  // å…ˆè·å–SHA
  var xhr1 = new XMLHttpRequest();
  xhr1.open('GET', 'https://api.github.com/repos/jiang72353093-ai/xuanran-culture/contents/index.html', true);
  xhr1.setRequestHeader('Authorization', 'token ' + token);
  xhr1.onreadystatechange = function() {
    if (xhr1.readyState === 4) {
      var sha = '';
      if (xhr1.status === 200) {
        var res = JSON.parse(xhr1.responseText);
        sha = res.sha;
      }
      
      // ä¸Šä¼ 
      var content = btoa(unescape(encodeURIComponent(html)));
      var data = JSON.stringify({
        message: 'Update from admin',
        content: content,
        sha: sha
      });
      
      var xhr2 = new XMLHttpRequest();
      xhr2.open('PUT', 'https://api.github.com/repos/jiang72353093-ai/xuanran-culture/contents/index.html', true);
      xhr2.setRequestHeader('Authorization', 'token ' + token);
      xhr2.setRequestHeader('Content-Type', 'application/json');
      xhr2.onreadystatechange = function() {
        if (xhr2.readyState === 4) {
          if (xhr2.status === 200 || xhr2.status === 201) {
            showToast('å‘å¸ƒæˆåŠŸï¼30ç§’åç”Ÿæ•ˆ');
          } else {
            showToast('å‘å¸ƒå¤±è´¥ï¼Œæ£€æŸ¥Token');
          }
        }
      };
      xhr2.send(data);
    }
  };
  xhr1.send();
}
</script>

</body>
</html>
