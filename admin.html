<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>渲染文化管理</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Arial,"Microsoft YaHei",sans-serif;background:#0a0a0a;color:#fff;padding:20px}
.hidden{display:none !important}

/* 登录 */
#loginBox{max-width:300px;margin:100px auto;text-align:center}
#loginBox h1{margin-bottom:30px;color:#d4a55c}
#loginBox input{width:100%;padding:12px;margin-bottom:15px;border:1px solid #333;background:#1a1a1a;color:#fff;border-radius:4px}
#loginBox button{width:100%;padding:12px;background:#d4a55c;color:#000;border:none;border-radius:4px;cursor:pointer;font-weight:bold}

/* 管理面板 */
#panel{max-width:800px;margin:0 auto}
.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:30px;padding-bottom:15px;border-bottom:1px solid #333}
.header button{padding:8px 16px;background:transparent;border:1px solid #666;color:#fff;cursor:pointer}

.section{background:#111;border:1px solid #222;padding:20px;margin-bottom:20px;border-radius:4px}
.section h3{color:#d4a55c;margin-bottom:15px}

input,textarea{width:100%;padding:10px;margin-bottom:10px;border:1px solid #333;background:#1a1a1a;color:#fff;border-radius:4px}
textarea{height:80px}

.work-item{display:flex;gap:10px;padding:10px;background:#1a1a1a;margin-bottom:10px;border-radius:4px;align-items:center}
.work-info{flex:1}
.work-info div{font-size:14px}
.work-info small{color:#888;font-size:12px}
.delete-btn{padding:5px 10px;background:#ff4444;color:#fff;border:none;border-radius:4px;cursor:pointer}

.add-btn{width:100%;padding:15px;background:transparent;border:2px dashed #444;color:#888;margin-bottom:15px;cursor:pointer}

.publish-box{background:#0a0a0a;border:1px solid #333;padding:20px;margin-top:20px}
.publish-box button{width:100%;padding:12px;background:#2ea043;color:#fff;border:none;border-radius:4px;cursor:pointer;margin-top:10px}

#msg{position:fixed;top:20px;left:50%;transform:translateX(-50%);background:#d4a55c;color:#000;padding:10px 20px;border-radius:4px;display:none}
</style>
</head>
<body>

<!-- 登录 -->
<div id="loginBox">
  <h1>渲染文化</h1>
  <input type="password" id="pwd" placeholder="密码">
  <button onclick="login()">登录</button>
</div>

<!-- 管理面板 -->
<div id="panel" class="hidden">
  <div class="header">
    <h2>管理后台</h2>
    <button onclick="logout()">退出</button>
  </div>

  <!-- 作品 -->
  <div class="section">
    <h3>作品管理</h3>
    <button class="add-btn" onclick="showAdd()">+ 添加作品</button>
    <div id="workList"></div>
  </div>

  <!-- 添加作品表单 -->
  <div class="section hidden" id="addForm">
    <h3>添加新作品</h3>
    <input type="text" id="t1" placeholder="作品标题">
    <input type="text" id="t2" placeholder="作品描述">
    <input type="text" id="t3" placeholder="B站视频链接">
    <input type="text" id="t4" placeholder="封面图片URL（选填）">
    <button onclick="saveWork()" style="background:#d4a55c;color:#000;padding:10px 20px;border:none;border-radius:4px;cursor:pointer">保存</button>
    <button onclick="hideAdd()" style="background:transparent;border:1px solid #666;color:#fff;padding:10px 20px;border-radius:4px;cursor:pointer;margin-left:10px">取消</button>
  </div>

  <!-- 公司信息 -->
  <div class="section">
    <h3>公司信息</h3>
    <input type="text" id="c1" value="成都渲染文化传媒有限公司" placeholder="公司名称">
    <input type="text" id="c2" value="用电影语言讲述品牌故事" placeholder="品牌口号">
    <textarea id="c3" placeholder="公司简介">成都渲染文化传媒有限公司，成立于2019年，是一家专注于影像创作的专业团队。</textarea>
    <input type="text" id="c4" value="5+" placeholder="年数" style="width:30%;display:inline-block;margin-right:5%">
    <input type="text" id="c5" value="200+" placeholder="项目数" style="width:30%;display:inline-block;margin-right:5%">
    <input type="text" id="c6" value="2.5万+" placeholder="获赞收藏" style="width:30%;display:inline-block">
  </div>

  <!-- 联系方式 -->
  <div class="section">
    <h3>联系方式</h3>
    <input type="text" id="p1" value="185 8249 3173" placeholder="电话">
    <input type="text" id="p2" placeholder="微信（选填）">
    <input type="text" id="p3" placeholder="邮箱（选填）">
  </div>

  <!-- 发布 -->
  <div class="publish-box">
    <h3 style="color:#d4a55c;margin-bottom:10px">发布网站</h3>
    <input type="password" id="token" placeholder="GitHub Token (ghp_xxxxxxxxxxxx)">
    <button onclick="publish()">发布到网站</button>
  </div>
</div>

<div id="msg"></div>

<script>
// 数据
var works = JSON.parse(localStorage.getItem('works') || '[{"id":1,"title":"【我用GH6拍了一部荒野大镖客】","desc":"361° 品牌 TVC","bvid":"BV1Zf421i7zq","img":"images/work-361.jpg"}]');

function $(id){return document.getElementById(id)}

function showMsg(text){
  var m=$('msg');
  m.innerHTML=text;
  m.style.display='block';
  setTimeout(function(){m.style.display='none'},2000);
}

function login(){
  if($('pwd').value=='xuanran2024'){
    $('loginBox').className='hidden';
    $('panel').className='';
    renderWorks();
    showMsg('登录成功');
  }else{
    alert('密码错误');
  }
}

function logout(){
  $('loginBox').className='';
  $('panel').className='hidden';
  $('pwd').value='';
}

function renderWorks(){
  var html='';
  for(var i=0;i<works.length;i++){
    var w=works[i];
    html+='<div class="work-item">';
    html+='<div class="work-info">';
    html+='<div>'+w.title+'</div>';
    html+='<small>'+w.desc+'</small>';
    html+='</div>';
    html+='<button class="delete-btn" onclick="del('+w.id+')">删除</button>';
    html+='</div>';
  }
  $('workList').innerHTML=html;
}

function showAdd(){
  $('addForm').className='section';
}

function hideAdd(){
  $('addForm').className='section hidden';
  $('t1').value='';
  $('t2').value='';
  $('t3').value='';
  $('t4').value='';
}

function saveWork(){
  var title=$('t1').value.trim();
  var desc=$('t2').value.trim();
  var url=$('t3').value.trim();
  var img=$('t4').value.trim();
  
  if(!title||!url){
    alert('请填写标题和链接');
    return;
  }
  
  var bvid='';
  var m=url.match(/BV[a-zA-Z0-9]+/);
  if(m)bvid=m[0];
  
  works.push({
    id:Date.now(),
    title:title,
    desc:desc,
    bvid:bvid,
    img:img
  });
  
  localStorage.setItem('works',JSON.stringify(works));
  renderWorks();
  hideAdd();
  showMsg('添加成功');
}

function del(id){
  if(!confirm('确定删除？'))return;
  var arr=[];
  for(var i=0;i<works.length;i++){
    if(works[i].id!=id)arr.push(works[i]);
  }
  works=arr;
  localStorage.setItem('works',JSON.stringify(works));
  renderWorks();
  showMsg('已删除');
}

function publish(){
  var token=$('token').value.trim();
  if(!token){
    alert('请输入Token');
    return;
  }
  showMsg('发布中...');
  
  // 生成HTML代码（简化版）
  var c1=$('c1').value,c2=$('c2').value,c3=$('c3').value;
  var c4=$('c4').value,c5=$('c5').value,c6=$('c6').value;
  var p1=$('p1').value,p2=$('p2').value,p3=$('p3').value;
  
  var worksHtml='';
  for(var i=0;i<works.length;i++){
    var w=works[i];
    var style=w.img?'background-image:url('+w.img+')':'background:#222';
    worksHtml+='<div style="'+style+';background-size:cover" onclick="play(\''+w.bvid+'\')">';
    worksHtml+='<div style="padding:20px;background:linear-gradient(to top,rgba(0,0,0,0.8),transparent)">'+w.desc+'</div>';
    worksHtml+='</div>';
  }
  
  var html='<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>'+c1+'</title>';
  html+='<style>body{font-family:sans-serif;background:#0a0a0a;color:#fff;margin:0}a{color:#d4a55c;text-decoration:none}.hero{height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center}';
  html+='.works{display:grid;grid-template-columns:repeat(3,1fr);gap:20px;padding:40px}.work{aspect-ratio:16/9;border:1px solid #333;cursor:pointer}</style></head><body>';
  html+='<div class="hero"><h1>'+c1+'</h1><p>'+c2+'</p><a href="#works">查看作品</a></div>';
  html+='<div class="works" id="works">'+worksHtml+'</div>';
  html+='<script>function play(bvid){var d=document.createElement("div");d.style.cssText="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.9);z-index:9999;display:flex;justify-content:center;align-items:center";d.innerHTML="<iframe src=\\'//player.bilibili.com/player.html?bvid="+bvid+"\\' style=\\'width:90%;max-width:800px;aspect-ratio:16/9;border:none\\'></iframe><button onclick=\\'this.parentElement.remove()\\' style=\\'position:absolute;top:20px;right:20px;background:none;border:2px solid #fff;color:#fff;padding:10px 20px;cursor:pointer\\'>关闭</button>";document.body.appendChild(d)}<\/script>';
  html+='</body></html>';
  
  // 上传
  var xhr=new XMLHttpRequest();
  xhr.open('GET','https://api.github.com/repos/jiang72353093-ai/xuanran-culture/contents/index.html',true);
  xhr.setRequestHeader('Authorization','token '+token);
  xhr.onload=function(){
    var sha='';
    if(xhr.status==200){
      sha=JSON.parse(xhr.responseText).sha;
    }
    var data=JSON.stringify({
      message:'Update',
      content:btoa(unescape(encodeURIComponent(html))),
      sha:sha
    });
    var x=new XMLHttpRequest();
    x.open('PUT','https://api.github.com/repos/jiang72353093-ai/xuanran-culture/contents/index.html',true);
    x.setRequestHeader('Authorization','token '+token);
    x.setRequestHeader('Content-Type','application/json');
    x.onload=function(){
      if(x.status==200||x.status==201){
        showMsg('发布成功！');
      }else{
        showMsg('发布失败');
      }
    };
    x.send(data);
  };
  xhr.send();
}
</script>

</body>
</html>
